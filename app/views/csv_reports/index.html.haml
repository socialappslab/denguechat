= render :partial => "shared/flashes"

.container

  .row
    .col-md-8.col-xs-8
      %h1.light-font
        Sus reportes cargados en CSV

    .col-md-4.col-xs-4
      .pull-right
        = link_to new_csv_report_path, :class => "btn btn-success btn-lg" do
          %i.fa.fa-file
          = I18n.t("views.buttons.upload_csv")

  .row.page-header-description
    .col-md-12
      %p.description
        Este es un sitio privado, sólo usted lo puede ver.

  .row
    .col-md-12
      .panel.panel-default
        %table.table.table-bordered.table-hover.text-center.statistics-table
          %thead
            %th.text-center
              CSV
            %th.text-center
              = I18n.t("attributes.location_id")
            %th.text-center
              Fecha de carga
            %th.text-center
              = I18n.t("activerecord.attributes.visit.visited_at")
            %th.text-center
              Condición
          %tbody
            - @csvs.each do |csv|
              - visits = csv.visits.order("visited_at ASC").map {|v| v.visited_at.strftime("%Y-%m-%d")}.uniq
              %tr{:data => {"csv_id" => csv.id}}
                %td{"style" => "width: 20%;"}
                  = link_to csv.csv_file_name, csv.csv.url
                %td{"style" => "width: 20%;"}
                  = csv.location.address if csv.location.present?
                %td{"style" => "width: 20%;"}
                  = csv.created_at.strftime("%Y-%m-%d %H:%M")
                %td{"style" => "width: 20%;"}
                  %ul.list-group
                    - visits.each do |visit_date|
                      %li.list-group-item
                        = visit_date
                %td{"style" => "width: 20%;"}
                  - if csv.csv_errors.present?
                    = link_to I18n.t("views.csv_reports.failed_with_errors"), csv_report_path(csv), :class => "btn btn-danger"
                  - elsif csv.parsed_at.blank?
                    = I18n.t("views.csv_reports.parsing") + "..."
                  - elsif csv.verified_at.blank?
                    = link_to I18n.t("views.csv_reports.verify"), verify_csv_report_path(csv), :class => "btn btn-warning"
                  - else
                    = link_to I18n.t("views.csv_reports.view"), csv_report_path(csv), :class => "btn btn-info"
