
%script{:src => "https://www.google.com/jsapi?autoload={'modules':[{'name':'visualization','version':'1','packages':['corechart']}]}", :type => "text/javascript"}

/------------------------------------------------------------------------------

= render :partial => "shared/flashes"

/------------------------------------------------------------------------------
.row{:style => "margin-bottom: 30px;"}
  .col-md-7.col-md-offset-1
    %p{:style => "margin-top: 10px;"}
      %i.fa.fa-lock
      Este es un sitio privado, sÃ³lo usted lo puede ver.

.row
  .col-md-8.col-md-offset-1
    %h1{:style => "font-size: 30px; margin-bottom: 30px;"}
      Sus reportes cargados en CSV
  .col-md-2
    = link_to new_neighborhood_csv_report_path(@neighborhood), :class => "btn btn-success btn-large", :style => "margin-bottom:20px;" do
      %i.fa.fa-file
      = I18n.t("views.buttons.upload_csv")


  .row
    .col-md-6.col-md-offset-3
      %table.table.table-bordered.table-hover.text-center.statistics-table
        %thead
          %th.text-center
            CSV
          %th.text-center
            Upload date
          %th.text-center
            Status
        %tbody
          - @csvs.each do |csv|
            %tr{:data => {"csv_id" => csv.id}}
              // NOTE: rowspan should always be +1 since it's counting its own
              // tr as well.
              - visits = csv.visits.order("visited_at ASC").includes(:inspections)
              - visits_row_span = visits.map {|v| v.inspections.count + 1}
              - csv_row_span    = visits_row_span.sum
              %td{:rowspan => (csv_row_span + 1), :data => {:csv => csv.csv_file_name} }
                = link_to csv.csv_file_name, csv.csv.url
              %td
                = csv.created_at.strftime("%Y-%m-%d %H:%M")
              %td{:rowspan => (csv_row_span + 1), :data => {:location => csv.location.address} }
                - if csv.parsed_at.blank?
                  Parsing
                - else
                  = link_to "View", neighborhood_csv_report_path(@neighborhood, csv), :class => "btn btn-info"
