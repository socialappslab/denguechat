

.row
  .span4.offset1
    - if flash[:notice] 
      .row#flash_dat_notice
        #flashNotice 
          %p
            = flash[:notice]
    - if flash[:alert] 
      .row#flash_dat_alert
        #flashAlert 
          %p
            = flash[:alert]
    %h1 Focos marcados
  %br
  .span#report_buttons{:style => "font-size:20px;"}
    / %h1 Marcar um foco
    
.row          

  .row

    -#Report List
    .span9.offset1
      = render :partial => 'reports/open_redesign'


    .span7#map_div{style: "margin-top:-63px;position:absolute;right:30px;overflow-y:hidden;overflow-x:hidden;"}
      #OSMap



      - if params[:view] == 'make_report'
        :javascript
          var map, tb;
          require(["esri/map", "esri/toolbars/draw", "esri/tasks/locator", "esri/layers/ArcGISTiledMapServiceLayer", "esri/SpatialReference", "esri/geometry/Point", "esri/config", "esri/graphic", "esri/symbols/SimpleMarkerSymbol", "esri/symbols/SimpleLineSymbol", "esri/symbols/TextSymbol", "dojo/_base/Color", "esri/symbols/PictureMarkerSymbol", "esri/renderers/ClassBreaksRenderer", "dojo/domReady!"], function(Map, Draw, Locator, Tiled, SpatialReference, Point, Geometry, Graphic, SimpleMarkerSymbol, SimpleLineSymbol, TextSymbol, Color, PictureMarkerSymbol, ClassBreaksRenderer) {
            var customExtent = new esri.geometry.Extent(667070.412263838,7456962.88258577,688175.480935968,7475960.60361382, new esri.SpatialReference({"wkid":29193}));

            var picBaseUrl = "http://static.arcgis.com/images/Symbols/Shapes/";
            var grey = new PictureMarkerSymbol("/assets/markers/grey_marker.png", 48, 48).setOffset(0, 0);
            var mixed = new PictureMarkerSymbol("/assets/markers/mixed_marker.png", 48, 48).setOffset(0, 0);
            var orange = new PictureMarkerSymbol("/assets/markers/orange_marker.png", 48, 48).setOffset(0, 0);
            var point = new Point(680291.2151545063, 7470751.29586681, new esri.SpatialReference({wkid: 29193}));
            map = new Map("map", {
              center: point,
              zoom: 4,
              extent: customExtent
            });

            var tiled = new Tiled("http://pgeo2.rio.rj.gov.br/ArcGIS2/rest/services/Basico/mapa_basico_utm/MapServer");
            map.addLayer(tiled);
            map.on("update-start", showLoading);
            map.on("update-end", hideLoading);
            map.on("load", function() {

              tb = new Draw(map);
              tb.on("draw-end", addGraphic);
              tb.activate("point");
            });



            function addGraphic(evt) {
              map.graphics.clear();
              map.enableMapNavigation();

              // figure out which symbol to use
              var symbol = new SimpleMarkerSymbol();
              symbol.setStyle("STYLE_PATH");
              symbol.setPath("M 10 10 L30 10 L20 30z");
              symbol.setColor(new Color("red"));

              $("input#x").val(evt.geometry.x);
              $("input#y").val(evt.geometry.y);
              map.graphics.add(new Graphic(evt.geometry, orange));
              map.centerAt(evt.mapPoint);

            }

            $("#street_type").change(function() {

            });
            $("#street_name").change(function() {
            });


            $("#street_number").change(function() {
              showLoading();
              $.ajax({
                url: "http://pgeo2.rio.rj.gov.br/ArcGIS2/rest/services/Geocode/DBO.Loc_composto/GeocodeServer/findAddressCandidates",
                type: "GET",
                dataType: "jsonp",
                data: {"f": "pjson", "Street": $("#street_type").val() + " " + $("#street_name").val() + " " + $("#street_number").val()},
                success: function(m) {
                  map.graphics.clear();
                  var candidates = m.candidates;


                  if (candidates.length > 0) {
                    map.graphics.add(new Graphic(new Point(candidates[0].location.x, candidates[0].location.y), orange));
                    $("input#x").val(candidates[0].location.x);
                    $("input#y").val(candidates[0].location.y);

                    map.centerAndZoom(new Point(candidates[0].location.x, candidates[0].location.y, new esri.SpatialReference({"wkid": 29193})), 5);
                  }
                },
                error: function(m) {
                  console.log(JSON.stringify(m));
                },
                complete: function() {
                  hideLoading();
                }
              });
            });
            $("input#go_to_mare").click(function() {
              map.centerAndZoom(new Point(680291.2151545063, 7471401.29586681, new esri.SpatialReference({"wkid": 29193})), 5)
            });

            function showLoading() {
              $("#loading").show();
              map.disableMapNavigation();
              map.hideZoomSlider();
            }

            function hideLoading() {
              $("#loading").hide();
              map.enableMapNavigation();
              map.showZoomSlider();
            }
          });
      -#- else



  .row{style: "height:600px;"}


:javascript
  //used to initialize map
   $(document).ready(function(){
      mapInit();
   });

