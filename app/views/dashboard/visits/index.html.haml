- content_for :scripts do
  %script{"src" => "https://www.google.com/jsapi?autoload={'modules':[{'name':'visualization','version':'1.1','packages':['corechart']}]}"}


- content_for :dashboard_content do

  .row{:style => "margin-top: 20px;", "ng-controller" => "dashboardTimeSeriesCtrl", :path => timeseries_api_v0_graph_path}
    .col-md-10.col-md-offset-1
      .panel.panel-default
        .panel-heading
          %h3.panel-title
            Visita Datos
        .panel-body
          %table.table.table-bordered
            %tr
              %td{:style => "width: 35%"}
                %p.form-label
                  Unidad
                .chart-filters{:style => "margin-top: 0px;"}
                  .btn-group
                    = label_tag nil, :class => "btn btn-default btn-xs", "ng-class" => "{'active': options.unit === 'daily'}" do
                      = radio_button_tag "chart[percentages]", "daily", nil, "ng-model" => "options.unit"
                      En un dia
                    = label_tag nil, :class => "btn btn-default btn-xs", "ng-class" => "{'active': options.unit === 'monthly'}" do
                      = radio_button_tag "chart[percentages]", "monthly", nil, "ng-model" => "options.unit"
                      En un mes
              %td{:rowspan => 2, :style => "width: 65%"}
                %p.form-label
                  Comunidades
                %ul.list-group
                  - @city.neighborhoods.each do |neighborhood|
                    %li.list-group-item{"ng-click" => "toggleNeighborhood(#{neighborhood.id})", :style => "cursor: hand;", "ng-class" => "neighborhoods.indexOf(#{neighborhood.id}) !== -1 ? 'list-group-item-success' : ''"}
                      = neighborhood.name
            %tr
              %td{:style => "width: 35%"}
                %p.form-label
                  = I18n.t("views.statistics.chart.time")
                .chart-filters{:style => "margin-top: 0px;"}
                  .btn-group
                    - [1, 3, 6].each do |month|
                      = label_tag nil, :class => "btn btn-default btn-xs", "ng-class" => "{active: options.timeframe === '#{month}' && !customDateRange}" do
                        = radio_button_tag nil, month.to_s, false, "ng-model" => "options.timeframe", "ng-click" => "customDateRange = false;"
                        = I18n.t("views.statistics.chart.filters.months", :count => month)
                    = label_tag  nil, :class => "btn btn-default btn-xs", "ng-class" => "{active: options.timeframe === '-1' && !customDateRange}" do
                      = radio_button_tag nil, "-1", false, "ng-model" => "options.timeframe", "ng-click" => "customDateRange = false;"
                      Todo
                    = label_tag  nil, :class => "btn btn-default btn-xs", "ng-class" => "{'active': customDateRange}" do
                      = radio_button_tag nil, true, false, "ng-model" => "customDateRange"
                      = I18n.t("views.statistics.chart.custom_date")
                  .text-center{"ng-show" => "customDateRange", "style" => "margin-top: 20px;"}
                    = select_tag nil, options_for_select( (1..12).map {|i| [i, i]} ), "ng-model" => "options.customStartMonth"
                    = select_tag nil, options_for_select( (2010..Time.zone.now.year).map {|i| [i, i]} ), "ng-model" => "options.customStartYear"
                    a
                    = select_tag nil, options_for_select( (1..12).map {|i| [i, i]} ), "ng-model" => "options.customEndMonth"
                    = select_tag nil, options_for_select( (2010..Time.zone.now.year).map {|i| [i, i]} ), "ng-model" => "options.customEndYear"



          .row{:style => "margin-top: 20px;"}
            .col-md-4
              %a.btn.btn-block.btn-success{"ng-click" => "generatePreview()", :style => "cursor: hand;"}
                Vista previa
            .col-md-4.pull-right
              %a.btn.btn-block.btn-success{"ng-click" => "generateCsv()", :style => "cursor: hand;"}
                Genere un reporte CSV

          .form-errors{:style => "display: block;", "ng-show" => "serverError || serverErrorMessage"}
            %p
              {{serverErrorMessage || "Algo saliÃ³ mal. Por favor, intente nuevamente."}}
          %h1.text-center{"ng-show" => "loading"}
            %i.fa.fa-refresh.fa-spin



          %hr


          .chart
            %h3.panel-title{"ng-show" => "state.chart"}
              = I18n.t('views.statistics.chart.title')

            .legend{:style => "margin-left: 0px; margin-top: 0px;", "ng-show" => "state.chart"}
              .row
                .col-xs-4
                  %span.chart-legend.red
                  %span.chart-label.light-font
                    = I18n.t('views.statistics.chart.percent_of_positive_sites')
                  -# %br

                .col-xs-4
                  %span.chart-legend.yellow
                  %span.chart-label.light-font
                    = I18n.t('views.statistics.chart.percent_of_potential_sites')
                  -# %br

                .col-xs-4
                  %span.chart-legend.green
                  %span.chart-label.light-font
                    = I18n.t('views.statistics.chart.percent_of_negative_sites')
            %hr

            #timeseries
              %i.fa.fa-refresh.fa-spin{"ng-show" => "chartLoading"}
              %h3.empty-chart-disclaimer{"ng-show" => "noChartData"}
                = I18n.t("common_terms.no_data")
              #timeseries-chart{"ng-hide" => "chartLoading || noChartData"}


        %table.table.table-bordered{"ng-show" => "timeseries.length > 0"}
          %thead
            %th{:style => "width: 10%"}
              Fecha de visita
            %th{:style => "width: 10%"}
              Lugares positivos (%)
            %th{:style => "width: 10%"}
              Lugares potenciales (%)
            %th{:style => "width: 10%"}
              Lugares sin criaderos (%)
            %th{:style => "width: 10%"}
              Total lugares
            %th{:style => "width: 10%"}
              Lugares positivos
            %th{:style => "width: 10%"}
              Lugares potenciales
            %th{:style => "width: 10%"}
              Lugares sin criaderos
            %th{:style => "width: 10%"}
              Lugares
          %tbody
            %tr{"ng-repeat" => "series in timeseries"}
              %td{:style => "width: 10%"}
                {{series.date}}
              %td{:style => "width: 10%"}
                {{series.positive.count}}
                ({{series.positive.percent}} %)
              %td{:style => "width: 10%"}
                {{series.potential.count}}
                ({{series.potential.percent}} %)
              %td{:style => "width: 10%"}
                {{series.negative.count}}
                ({{series.negative.percent}} %)
              %td{:style => "width: 8%"}
                {{series.total.count}}
              %td{:style => "width: 10%"}
                .show{"ng-repeat" => "location in series.positive.locations"}
                  {{location}}
              %td{:style => "width: 10%"}
                .show{"ng-repeat" => "location in series.potential.locations"}
                  {{location}}
              %td{:style => "width: 10%"}
                .show{"ng-repeat" => "location in series.negative.locations"}
                  {{location}}
              %td{:style => "width: 10%"}
                .show{"ng-repeat" => "location in series.total.locations"}
                  {{location}}
        .panel-footer
          Seleccione comunidades, la unidad y el tiempo para generar informe.
