
var GMAP_API_KEY = "AIzaSyDGcpQfu7LSPkd9AJnQ0cztYylHa-fyE18" ;
var GMAPS_VERSION = 3.17; //latest stable version
var REGION_ZOOM = 13; // the zoom level at which we see the entire neighborhood


var initializeMaps = function() {
  var mapOptions = {
    zoom: REGION_ZOOM,
    streetViewControl: false,
    disableDoubleClickZoom: true,
    center: new google.maps.LatLng(communityLatitude, communityLongitude)
  };

  // Initialize the map, and add the geographical layer to it.
  map = new google.maps.Map(document.getElementById('gmap'), mapOptions);
  $("#loading").hide();

  var markers = []
  var locations = openLocations;
  for(var i = 0; i < locations.length; i++) {
    var latitude  = locations[i].latitude;
    var longitude = locations[i].longitude;
    var markerLoc = new google.maps.LatLng(latitude, longitude);
    marker = new google.maps.Marker({
      position: markerLoc,
      map: map,
      draggable:false,
      animation: google.maps.Animation.DROP,
      icon: "<%= asset_path('markers/orange_marker') %>"
    });
    markers.push(marker);
  }

  new MarkerClusterer(map, markers);
}

var ctrl = function ($scope, $http, $attrs) {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  //sensor parameter no longer needed
  script.src = 'https://maps.googleapis.com/maps/api/js?v='+GMAPS_VERSION+'&libraries=visualization&callback=initializeMaps';
  document.body.appendChild(script);
};

angular.module("denguechat.controllers").controller("heatmapCtrl", ["$scope", "$http", "$attrs", ctrl]);
