var dengueChatApp = angular.module('dengueChatApp', ["sessionService", "ngCookies", "ngSanitize"]);

// dengueChatApp.config(['$routeProvider', "$locationProvider", function($routeProvider, $locationProvider) {
//   $routeProvider.when('/users/:userID', {
//     templateUrl: "<%= asset_path('posts/index.html') %>",
//     controller: 'DCPostListCtrl'
//   });
//
//   $locationProvider.html5Mode({
//     enabled: true,
//     requireBase: false
//   });
// }]);

angular.module("sessionService", []).factory('session', function($location, $http, $q) {
  var service = {
    currentUser: null,

    requestCurrentUser: function() {
      if (service.isAuthenticated()) {
        return $q.when(service.currentUser);
      } else {
        return $http.get("/api/v0/sessions/current").then(function(response) {
          service.currentUser = response.data.user;
          return service.currentUser;
        });
      }
    },

    isAuthenticated: function(){
      return !!service.currentUser;
    }
  };

  return service;
});
